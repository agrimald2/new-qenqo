import{_ as w,a as P,b as _}from"./SectionTitleLineWithButton-0f7c04bc.js";import{o as m,c as u,w as l,a as i,b as a,u as o,d,t as g,e as p,Z as V}from"./app-8697b0b7.js";import{_ as v}from"./BaseButton-c4ef6fc6.js";import{m as c}from"./mdi-7f5f296a.js";import{_ as f}from"./CardBoxWidget-4cedd33f.js";import{_ as r}from"./CardBox-f30d27b6.js";import{_ as h}from"./FormControl-f5f76d11.js";import{_ as $}from"./PillTag-ee198916.js";import S from"./Create-e5562148.js";import C from"./Create-52898ead.js";import y from"./List-9aff6f15.js";import b from"./List-08a1e5ea.js";import"./main-136096ca.js";import k from"./Table-75822dd3.js";import A from"./Create-64340581.js";import"./UserAvatar-d7ff0a76.js";import"./BaseDivider-12cf6a0a.js";import"./OverlayLayer-2aed81c6.js";import"./BaseLevel-a90da931.js";import"./FormField-3df4b2cb.js";import"./BaseButtons-1517e964.js";import"./CardBoxModal-8729ec4d.js";const T={class:"font-bold text-xl"},D=["max","value"],F={class:"grid grid-cols-1 gap-6 lg:grid-cols-3 mb-6"},N={class:"grid md:grid-cols-2 grid-col-1 gap-4"},B={class:"md:col-2 col"},O={class:"md:col-2 col"},U={class:"mb-6"},E={class:"grid grid-cols-1 gap-6 lg:grid-cols-3 mb-6"},I={props:["activePlan"],data(){return{showCreateStudents:!1,showCreatePayment:!1,showCreateAppointment:!1,active_students:[],students:[],selectedStudent:null,payments:[],appointment_statuses:[{id:1,value:"Confirmado"},{id:2,value:"Finalizado"},{id:3,value:"Cancelado"}],appointments:[]}},components:[S,y,C,b,A],methods:{toggleCreateStudents(){this.showCreateStudents=!this.showCreateStudents},toggleCreatePayment(){this.showCreatePayment=!this.showCreatePayment},toggleCreateAppointment(){this.showCreateAppointment=!this.showCreateAppointment},handleNewStudent(e){this.toggleCreateStudents(),this.addStudentToActivePlan(e)},fetchActivePlanStudents(){i.get("/api/activePlans/"+this.activePlan.id+"/students").then(e=>{this.active_students=e.data}).catch(e=>{console.error(e)})},fetchStudents(){i.get("/api/students").then(e=>{this.students=e.data}).catch(e=>{console.error(e)})},async fetchPayments(){i.get("/api/activePlanPayments/"+this.activePlan.id).then(e=>{this.payments=e.data,this.fetchActivePlan()}).catch(e=>{console.log("Emit:"),console.error(e)})},async fetchActivePlan(){i.get("/api/activePlans/getById/"+this.activePlan.id).then(e=>{this.activePlan=e.data}).catch(e=>{console.error(e)})},async fetchAppointment(){i.get("/api/activePlans/appointments/"+this.activePlan.id).then(e=>{console.log(e.data),this.appointments=e.data}).catch(e=>{console.log("Emit:"),console.error(e)})},async addStudentToActivePlan(e){try{const t={active_plan_id:this.activePlan.id,student_id:e};await i.post("/api/activePlans/"+this.activePlan.id+"/students",t),this.fetchActivePlanStudents()}catch(t){console.error(t)}},addSelectedStudentToActivePlan(){this.addStudentToActivePlan(this.selectedStudent.value)},async removeStudentFromActivePlan(e){try{await i.delete(`/api/activePlans/${this.activePlan.id}/students/${e}`),this.fetchActivePlanStudents()}catch(t){console.error(t)}},async removeStudentFromActivePlan(e){try{await i.post("/api/activePlans/delete/student",{student_id:e,active_plan_id:this.activePlan.id}),this.fetchActivePlanStudents()}catch(t){console.error(t)}}},mounted(){this.fetchActivePlanStudents(),this.fetchStudents(),this.fetchPayments(),this.fetchAppointment()}},ie=Object.assign(I,{__name:"Show",setup(e){return(t,s)=>(m(),u(w,null,{default:l(()=>[a(o(V),{title:"Tarifas"}),a(_,null,{default:l(()=>[a(P,{title:"Grupo: "+e.activePlan.name},null,8,["title"]),a(r,{class:"mb-2"},{default:l(()=>[d("h3",T,g(e.activePlan.start_date)+" al "+g(e.activePlan.end_date),1),d("progress",{class:"flex w-2/5 self-center lg:w-full",max:Math.floor((new Date(e.activePlan.end_date)-new Date(e.activePlan.start_date))/(1e3*60*60*24)),value:Math.floor((new Date-new Date(e.activePlan.start_date))/(1e3*60*60*24))},null,8,D)]),_:1}),d("div",F,[a(f,{trend:"de "+e.activePlan.total,"trend-type":"up",color:"text-blue-500",icon:t.mdiCartOutline,number:e.activePlan.total_payed,prefix:"S/ ",label:"Pagado"},null,8,["trend","icon","number"]),a(f,{trend:"de"+e.activePlan.rate_sessions_number,"trend-type":"alert",color:"text-red-500",icon:t.mdiCartOutline,number:e.activePlan.rate_sessions_assisted,prefix:"",label:"Sesiones"},null,8,["trend","icon","number"]),a(f,{trend:"de 20","trend-type":"up",color:"text-red-500",icon:t.mdiChartTimelineVariant,number:e.activePlan.people_number,suffix:"",label:"Alumnos"},null,8,["icon","number"])]),d("div",N,[d("div",B,[a(v,{onClick:t.toggleCreateStudents,icon:o(c),label:"Alumnos",class:"bg-green-300 my-2",color:"",target:"_blank","rounded-full":""},null,8,["onClick","icon"]),a(r,{class:"mb-2"},{default:l(()=>[a(h,{icon:o(c),type:"select",options:t.students.map(n=>({label:n.user.name,value:n.id})),onChange:t.addSelectedStudentToActivePlan,modelValue:t.selectedStudent,"onUpdate:modelValue":s[0]||(s[0]=n=>t.selectedStudent=n)},null,8,["icon","options","onChange","modelValue"]),t.showCreateStudents?(m(),u(S,{key:0,onStudentCreated:t.handleNewStudent},null,8,["onStudentCreated"])):p("",!0),a(y,{class:"my-2 border rounded p-2",students:t.active_students,onDeleteStudent:t.removeStudentFromActivePlan},null,8,["students","onDeleteStudent"])]),_:1})]),d("div",O,[a(v,{onClick:t.toggleCreatePayment,icon:o(c),label:"Pagos",class:"bg-green-300 my-2 mx-2"},null,8,["onClick","icon"]),a($,{color:"warning",label:"Falta Pagar "+(e.activePlan.total-e.activePlan.total_payed),small:t.pillsSmall,outline:t.pillsOutline,icon:t.pillsIcon},null,8,["label","small","outline","icon"]),a(r,{class:"mb-2"},{default:l(()=>[t.showCreatePayment?(m(),u(C,{key:0,activePlan:e.activePlan,onPaymentAdded:t.fetchPayments},null,8,["activePlan","onPaymentAdded"])):p("",!0),a(b,{payments:t.payments},null,8,["payments"])]),_:1})])]),d("div",U,[a(P,{title:"Clases"}),a(v,{onClick:t.toggleCreateAppointment,icon:o(c),label:"Clase",class:"bg-green-300 my-2",color:"",target:"_blank","rounded-full":""},null,8,["onClick","icon"]),d("div",E,[a(r,{class:"mb-2"},{default:l(()=>[a(h,{icon:o(c),type:"date",onChange:t.addSelectedStudentToActivePlan,modelValue:t.selectedStudent,"onUpdate:modelValue":s[1]||(s[1]=n=>t.selectedStudent=n)},null,8,["icon","onChange","modelValue"])]),_:1}),a(r,{class:"mb-2"},{default:l(()=>[a(h,{icon:o(c),type:"date",onChange:t.addSelectedStudentToActivePlan,modelValue:t.selectedStudent,"onUpdate:modelValue":s[2]||(s[2]=n=>t.selectedStudent=n)},null,8,["icon","onChange","modelValue"])]),_:1}),a(r,{class:"mb-2"},{default:l(()=>[a(h,{icon:o(c),type:"select",options:t.appointment_statuses.map(n=>({label:n.value,value:n.id})),onChange:t.addSelectedStudentToActivePlan,modelValue:t.selectedStudent,"onUpdate:modelValue":s[3]||(s[3]=n=>t.selectedStudent=n)},null,8,["icon","options","onChange","modelValue"])]),_:1})]),t.showCreateAppointment?(m(),u(A,{key:0,activePlan:e.activePlan},null,8,["activePlan"])):p("",!0),a(r,{class:"mb-2"},{default:l(()=>[a(k,{appointments:t.appointments},null,8,["appointments"])]),_:1})])]),_:1})]),_:1}))}});export{ie as default};
