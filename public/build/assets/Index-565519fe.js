import{_ as b}from"./AsideMenu-8b4b5ee4.js";import{_ as y}from"./LayoutAuthenticated-bde042ce.js";import{_ as C}from"./SectionTitleLineWithButton-cf1e246b.js";import{o as d,c,w as s,a as u,b as a,u as i,Z as P,d as D,e as w}from"./app-9f2eb8dd.js";import{_ as k}from"./BaseButton-9a3f1db7.js";import{m as l}from"./mdi-66a87996.js";import{_ as m}from"./CardBox-e1e2cea0.js";import{_ as f}from"./FormControl-587b9277.js";import p from"./Create-25b952ee.js";import h from"./Table-41accb25.js";import"./BaseIcon-9a2ca4ad.js";import"./main-4957fc0e.js";import"./UserAvatar-4cfac3ec.js";import"./BaseDivider-b91b2461.js";import"./colors-ea023820.js";import"./OverlayLayer-1e6f50da.js";import"./BaseLevel-c3fa91a4.js";import"./IconRounded-cea43341.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./CardBoxModal-13b1714e.js";import"./BaseButtons-91e2cdd3.js";const V={class:"grid grid-cols-1 gap-6 lg:grid-cols-3 mb-6"},v={data(){return{showCreate:!1,payments:[],filter:{startDate:null,endDate:null}}},components:[p,,h],methods:{showCreateMethod(){this.showCreate=!0},fetch(){u.get("/getPayments",{params:{start_date:this.filter.startDate,end_date:this.filter.endDate}}).then(t=>{this.payments=t.data}).catch(t=>{console.error(t)})},fetchStudents(){u.get("/api/students").then(t=>{this.students=t.data}).catch(t=>{console.error(t)})},formatPayments(){if(!this.payments||!this.payments.length)return[];const t=this.payments.map(e=>({Fecha:new Date(e.created_at).toLocaleDateString(),Referido:e.student.referred_by?e.student.referred_by.username:"no",Estudiante:e.student.user?e.student.user.name:"no",Plan:e.active_plan.rate_name,Pagado:e.total_payed,"%":e.active_plan.comission+"%",Comision:Number(e.total_payed)*(Number(e.active_plan.comission)/100),IGV:Number(e.total_payed)*.18}));return console.dir(t),t},exportToExcel(){const t=this.formatPayments();if(!t||!t.length)return;const e=this.toCsv(t),o=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(o),n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download","ReporteDePagos.csv"),document.body.appendChild(n),n.click()},toCsv(t){if(!t||!t.length)return"";const e=",",o=Object.keys(t[0]),r=o.join(e)+`
`,n=t.map(_=>o.map(g=>'"'+_[g]+'"').join(e)).join(`
`);return r+n}},mounted(){this.fetchStudents(),this.fetch()}},J=Object.assign(v,{__name:"Index",setup(t){return(e,o)=>(d(),c(y,null,{default:s(()=>[a(i(P),{title:"Pagos"}),a(b,null,{default:s(()=>[a(C,{title:"Pagos"}),D("div",V,[a(m,{class:"mb-2"},{default:s(()=>[a(f,{icon:i(l),type:"date",modelValue:e.filter.startDate,"onUpdate:modelValue":o[0]||(o[0]=r=>e.filter.startDate=r),onChange:e.fetch},null,8,["icon","modelValue","onChange"])]),_:1}),a(m,{class:"mb-2"},{default:s(()=>[a(f,{icon:i(l),type:"date",modelValue:e.filter.endDate,"onUpdate:modelValue":o[1]||(o[1]=r=>e.filter.endDate=r),onChange:e.fetch},null,8,["icon","modelValue","onChange"])]),_:1}),a(m,{class:"mb-2 center text-center"},{default:s(()=>[a(k,{onClick:e.exportToExcel,icon:i(l),label:"Exportar Excel",class:"bg-green-300",color:"green",target:"_blank","rounded-full":""},null,8,["onClick","icon"])]),_:1})]),a(h,{payments:e.payments},null,8,["payments"]),e.showCreate?(d(),c(p,{key:0,onPaymentMethodCreated:e.fetch},null,8,["onPaymentMethodCreated"])):w("",!0)]),_:1})]),_:1}))}});export{J as default};
